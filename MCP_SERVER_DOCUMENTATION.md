# Документация MCP Server для Task Tracker

## Описание

Task Tracker MCP Server — это сервер, реализующий протокол Model Context Protocol (MCP) для управления задачами в Task Tracker приложении. Он позволяет AI-ассистентам взаимодействовать с задачами через стандартизированный протокол.

MCP (Model Context Protocol) Server — это сервер, который позволяет AI-ассистентам (таким как Claude в Cursor) взаимодействовать с вашим приложением Task Tracker. Через MCP Server AI может создавать, обновлять, удалять и получать информацию о задачах.

## Архитектура

### Технологический стек

- **@modelcontextprotocol/sdk** - SDK для создания MCP серверов
- **TypeScript** - Типобезопасность и современный JavaScript
- **Node.js** - Среда выполнения

### Структура сервера

```
mcp-server/
├── src/
│   └── index.ts          # Основной файл сервера
├── dist/                 # Скомпилированный JavaScript
├── package.json
└── tsconfig.json
```

### Основные компоненты

1. **TaskTrackerMCPServer класс**
   - Инициализация MCP сервера
   - Регистрация обработчиков запросов
   - Обработка ошибок

2. **Хранилище данных**
   - JSON файл: `~/.task-tracker/tasks.json` (Linux/Mac) или `C:\Users\ВашеИмя\.task-tracker\tasks.json` (Windows)
   - Функции: `readTasks()`, `writeTasks()`

3. **Инструменты (Tools)**
   - 5 инструментов для управления задачами
   - JSON схемы для валидации входных данных

## Установка и настройка

### Шаг 1: Установка зависимостей

Откройте терминал в папке `mcp-server` и выполните:

```bash
cd mcp-server
npm install
```

### Шаг 2: Сборка проекта

Скомпилируйте TypeScript код в JavaScript:

```bash
npm run build
```

После успешной сборки в папке `dist` появится файл `index.js`.

### Шаг 3: Проверка работы сервера

Для проверки можно запустить сервер напрямую:

```bash
npm start
```

Сервер запустится и будет готов к работе. Для остановки нажмите `Ctrl+C`.

### Режим разработки

Для разработки с автоматической перезагрузкой при изменениях:

```bash
npm run dev
```

Этот режим использует `tsx` для запуска TypeScript файлов напрямую без компиляции.

## Доступные инструменты

### 1. list_tasks

Получить список всех задач или отфильтрованных по статусу.

**Параметры:**
```json
{
  "status": "todo" | "in-progress" | "done" | "all"
}
```

**Пример использования:**
```json
{
  "status": "todo"
}
```

**Ответ:**
```json
[
  {
    "id": "1234567890",
    "title": "Завершить проект",
    "description": "Необходимо завершить все задачи",
    "status": "todo",
    "createdAt": 1234567890
  }
]
```

### 2. create_task

Создать новую задачу.

**Параметры:**
```json
{
  "title": "string (обязательно)",
  "description": "string (опционально)",
  "status": "todo" | "in-progress" | "done" (по умолчанию: "todo")
}
```

**Пример использования:**
```json
{
  "title": "Изучить MCP протокол",
  "description": "Прочитать документацию и создать пример сервера",
  "status": "in-progress"
}
```

**Ответ:**
```json
{
  "content": [
    {
      "type": "text",
      "text": "Задача успешно создана: { ... }"
    }
  ]
}
```

### 3. update_task_status

Обновить статус существующей задачи.

**Параметры:**
```json
{
  "taskId": "string (обязательно)",
  "status": "todo" | "in-progress" | "done" (обязательно)
}
```

**Пример использования:**
```json
{
  "taskId": "1234567890",
  "status": "done"
}
```

**Ответ:**
```json
{
  "content": [
    {
      "type": "text",
      "text": "Статус задачи обновлен: { ... }"
    }
  ]
}
```

### 4. delete_task

Удалить задачу.

**Параметры:**
```json
{
  "taskId": "string (обязательно)"
}
```

**Пример использования:**
```json
{
  "taskId": "1234567890"
}
```

**Ответ:**
```json
{
  "content": [
    {
      "type": "text",
      "text": "Задача удалена: { ... }"
    }
  ]
}
```

### 5. get_task_statistics

Получить статистику по задачам (количество по каждому статусу).

**Параметры:** Нет

**Пример использования:**
```json
{}
```

**Ответ:**
```json
{
  "total": 10,
  "todo": 5,
  "in-progress": 3,
  "done": 2
}
```

## Интеграция с AI-ассистентами

### Настройка в Cursor

1. Откройте настройки Cursor (обычно через `Ctrl+,` или `Cmd+,`)

2. Найдите раздел "MCP Servers" или "Model Context Protocol"

3. Добавьте следующую конфигурацию:

**Для Windows:**
```json
{
  "mcpServers": {
    "task-tracker": {
      "command": "node",
      "args": ["D:\\Task-Tracker\\mcp-server\\dist\\index.js"]
    }
  }
}
```

**Для Linux/Mac:**
```json
{
  "mcpServers": {
    "task-tracker": {
      "command": "node",
      "args": ["/absolute/path/to/Task-Tracker/mcp-server/dist/index.js"]
    }
  }
}
```

**Важно:** 
- Замените путь на абсолютный путь к вашему проекту
- Используйте двойные обратные слеши (`\\`) в Windows или обычные слеши (`/`) в Linux/Mac
- После изменения конфигурации **обязательно перезапустите Cursor**

### Настройка в Claude Desktop

Добавьте в файл конфигурации Claude Desktop (обычно `%APPDATA%\\Claude\\claude_desktop_config.json` на Windows или `~/Library/Application Support/Claude/claude_desktop_config.json` на Mac):

**Для Windows:**
```json
{
  "mcpServers": {
    "task-tracker": {
      "command": "node",
      "args": ["D:\\Task-Tracker\\mcp-server\\dist\\index.js"]
    }
  }
}
```

**Для Linux/Mac:**
```json
{
  "mcpServers": {
    "task-tracker": {
      "command": "node",
      "args": ["/absolute/path/to/mcp-server/dist/index.js"]
    }
  }
}
```

**Важно:** Используйте абсолютный путь к файлу `dist/index.js`. После изменения конфигурации перезапустите Claude Desktop.

### Проверка подключения

После перезапуска Cursor/Claude Desktop, AI-ассистент должен автоматически подключиться к MCP Server. Вы можете проверить это, попросив AI:

```
Покажи мне список всех задач
```

Если сервер работает правильно, AI сможет использовать инструменты для работы с задачами.

## Использование через AI-ассистента

После настройки вы можете использовать AI для управления задачами естественным языком:

### Примеры команд:

1. **Создание задачи:**
   ```
   Создай задачу "Изучить TypeScript" со статусом "in-progress"
   ```
   
   AI использует инструмент `create_task` с параметрами:
   ```json
   {
     "title": "Изучить TypeScript",
     "status": "in-progress"
   }
   ```

2. **Получение списка задач:**
   ```
   Покажи мне все задачи со статусом "todo"
   ```
   
   AI использует инструмент `list_tasks` с параметрами:
   ```json
   {
     "status": "todo"
   }
   ```

3. **Обновление статуса:**
   ```
   Переведи задачу с ID 1234567890 в статус "done"
   ```
   
   AI использует инструмент `update_task_status` с параметрами:
   ```json
   {
     "taskId": "1234567890",
     "status": "done"
   }
   ```

4. **Получение статистики:**
   ```
   Сколько у меня задач в работе?
   ```
   
   AI использует инструмент `get_task_statistics` и возвращает количество задач со статусом "in-progress".

5. **Удаление задачи:**
   ```
   Удали задачу с ID 1234567890
   ```
   
   AI использует инструмент `delete_task` с параметрами:
   ```json
   {
     "taskId": "1234567890"
   }
   ```

## Хранение данных

MCP Server сохраняет все задачи в JSON файл:

- **Windows:** `C:\Users\ВашеИмя\.task-tracker\tasks.json`
- **Linux/Mac:** `~/.task-tracker/tasks.json`

**Важно:** Это хранилище **отдельно** от localStorage браузера, поэтому задачи, созданные через MCP Server, не будут автоматически отображаться в веб-приложении и наоборот.

## Примеры кода

### Инициализация сервера

```typescript
const server = new TaskTrackerMCPServer();
server.run().catch(console.error);
```

### Чтение задач

```typescript
async function readTasks(): Promise<Task[]> {
  try {
    await ensureStorageDirectory();
    const data = await fs.readFile(STORAGE_PATH, 'utf-8');
    return JSON.parse(data);
  } catch {
    return [];
  }
}
```

### Создание задачи

```typescript
case 'create_task': {
  const tasks = await readTasks();
  const newTask: Task = {
    id: Date.now().toString(),
    title: args?.title as string,
    description: (args?.description as string) || '',
    status: (args?.status as TaskStatus) || 'todo',
    createdAt: Date.now(),
  };
  tasks.push(newTask);
  await writeTasks(tasks);
  return { content: [{ type: 'text', text: `Задача создана: ...` }] };
}
```

## Решение проблем

### Проблема: Сервер не запускается

**Решение:**
1. Убедитесь, что установлены все зависимости: `npm install`
2. Проверьте, что TypeScript скомпилирован: `npm run build`
3. Проверьте, что Node.js установлен: `node --version`
4. Проверьте права доступа к файлу: `chmod +x dist/index.js` (Linux/Mac)

### Проблема: Ошибки при чтении/записи файлов

**Решение:**
1. Проверьте права на создание директории `~/.task-tracker/` (или `C:\Users\ВашеИмя\.task-tracker\` на Windows)
2. Убедитесь, что достаточно места на диске
3. Проверьте, что путь к домашней директории правильный
4. Проверьте логи сервера для детальной информации об ошибке

### Проблема: AI не видит инструменты

**Решение:**
1. Убедитесь, что путь к серверу **абсолютный** (не относительный)
2. Проверьте, что файл `dist/index.js` существует
3. Проверьте, что сервер запускается без ошибок
4. Перезапустите AI-ассистент после изменения конфигурации
5. Проверьте логи Cursor/Claude Desktop на наличие ошибок

### Проблема: Задачи не синхронизируются с веб-приложением

**Важно:** Это ожидаемое поведение. MCP Server использует отдельное хранилище (JSON файл), а веб-приложение использует localStorage браузера. Они не синхронизируются автоматически.

## Ограничения и будущие улучшения

### Текущие ограничения

1. **Отдельное хранилище**: MCP Server использует JSON файл, не синхронизируется с localStorage браузера
2. **Нет аутентификации**: Все задачи хранятся локально без разделения по пользователям
3. **Нет валидации формата**: Не проверяется корректность формата файла задач

### Планируемые(возможные) улучшения

1. **API интеграция**: Синхронизация с веб-приложением через API
2. **WebSocket поддержка**: Реал-тайм обновления между MCP Server и приложением
3. **Расширенная статистика**: Добавить инструменты для аналитики и отчетов
4. **Фильтры и поиск**: Инструменты для поиска задач по различным критериям
5. **Теги и категории**: Поддержка тегов и категорий задач через MCP

## Какую проблему решает MCP Server?

### Автоматизация управления задачами

MCP Server позволяет AI-ассистентам автоматически:
- Создавать задачи на основе диалога
- Обновлять статусы задач
- Получать статистику и отчеты
- Управлять задачами без прямого взаимодействия с UI

### Интеграция в рабочий процесс

Примеры использования:
- **Во время работы**: AI создает задачи на основе ваших запросов
- **Планирование**: AI помогает организовать задачи по статусам
- **Отчетность**: Быстрое получение статистики через AI

### Унификация интерфейса

MCP протокол стандартизирует взаимодействие между AI-ассистентами и приложениями, что позволяет:
- Использовать один сервер с разными AI-ассистентами
- Легко добавлять новые инструменты
- Интегрироваться с другими MCP-совместимыми системами

## Архитектура реализации

Сервер реализован с использованием `@modelcontextprotocol/sdk` и предоставляет следующие возможности:

- Чтение и запись задач из/в JSON файл
- Валидация входных данных через JSON схемы
- Обработка ошибок с использованием McpError
- Типизация TypeScript для безопасности типов

## Заключение

Task Tracker MCP Server демонстрирует, как можно интегрировать веб-приложение с AI-ассистентами через Model Context Protocol. Это открывает новые возможности для автоматизации и улучшения пользовательского опыта, позволяя AI-ассистентам управлять задачами естественным языком.
